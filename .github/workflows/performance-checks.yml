name: Performance Checks

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]

jobs:
  performance-audit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: |
        npm install --save-dev \
          eslint \
          eslint-plugin-sonarjs

    - name: Check for redundant API calls
      run: node .github/scripts/check-api-calls.cjs

    - name: Verify caching implementation
      run: node .github/scripts/check-caching.cjs

    - name: Check rate limiter usage
      run: node .github/scripts/check-rate-limiter-usage.cjs

    - name: Verify pagination patterns
      run: node .github/scripts/check-pagination.cjs

    - name: Check for progress indicators
      run: node .github/scripts/check-progress-indicators.cjs

    - name: Scan for blocking operations
      run: node .github/scripts/check-blocking-operations.cjs

    - name: Check for polling without purpose
      run: node .github/scripts/check-polling.cjs

    - name: Verify debouncing implementation
      run: node .github/scripts/check-debouncing.cjs

    - name: Check parallel request usage
      run: node .github/scripts/check-parallel-requests.cjs

    - name: Analyze content script efficiency
      run: node .github/scripts/check-content-script-efficiency.cjs

    - name: Check service worker efficiency
      run: node .github/scripts/check-service-worker.cjs

    - name: Generate Performance Report
      if: always()
      run: node .github/scripts/generate-performance-report.cjs

    - name: Upload Performance Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: performance-report
        path: performance-report.json
